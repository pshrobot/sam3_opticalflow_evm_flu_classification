# Optical Flow 기반 닭 건강 상태 분류 실험 보고서

## 1. 실험 개요

양계장 CCTV 영상에서 추출한 optical flow 데이터를 기반으로 정상(normal)과 병든(sick) 닭을 분류하는 LightGBM 모델의 성능을 비교 분석하였다. 총 4가지 optical flow 추출 방식을 실험하였다.

### 실험 조건
- **데이터**: Normal 6,325 프레임 / Sick 6,324 프레임 (총 12,649 프레임)
- **분할**: Train 80% (10,119) / Test 20% (2,530)
- **모델**: LightGBM (GBDT)
- **검증**: 5-Fold Stratified Cross Validation

---

## 2. 실험 방법별 결과

### 방법 A: 전체 프레임 - 이전 프레임만 사용
- **출처**: `output/classifier/`
- **피처 수**: 17개
- **방법**: 프레임 전체 영역의 optical flow 통계 (이전 프레임 기준)

| 지표 | CV 평균 | CV 표준편차 | 테스트 |
|------|---------|-------------|--------|
| Accuracy | 77.78% | ±0.34% | 77.19% |
| Precision | 77.33% | - | 76.54% |
| Recall | 78.61% | - | 78.42% |
| F1 Score | 77.96% | ±0.20% | 77.47% |
| **AUC** | **85.75%** | ±0.30% | **85.88%** |

### 방법 B: 전체 프레임 - 이전/현재 합집합
- **출처**: `output/classifier_union/`
- **피처 수**: 17개
- **방법**: 프레임 전체 영역의 optical flow 통계 (이전+현재 프레임 합집합)

| 지표 | CV 평균 | CV 표준편차 | 테스트 |
|------|---------|-------------|--------|
| Accuracy | 76.91% | ±0.57% | 77.59% |
| Precision | 76.47% | - | 76.56% |
| Recall | 77.74% | - | 79.53% |
| F1 Score | 77.10% | ±0.48% | 78.01% |
| **AUC** | **84.90%** | ±0.43% | **85.25%** |

### 방법 C: ID별 추적 - 이전 프레임만 사용
- **출처**: `output/models/results_20251230_202856.json`
- **피처 수**: 403개 (500개 히스토그램 - 면적/개체수 제외)
- **방법**: 개별 닭 ID를 추적하여 각 ID의 optical flow 통계를 분위수 기반 히스토그램으로 변환 (이전 프레임 기준)

| 지표 | CV 평균 | CV 표준편차 | 테스트 |
|------|---------|-------------|--------|
| Accuracy | 83.39% | ±0.57% | 83.99% |
| Precision | 83.95% | ±0.65% | 84.13% |
| Recall | 82.57% | ±1.21% | 83.79% |
| F1 Score | 83.25% | ±0.65% | 83.96% |
| **AUC** | **91.59%** | ±0.38% | **91.46%** |

### 방법 D: ID별 추적 - 이전/현재 합집합 (최고 성능)
- **출처**: `output/models/results_20260101_123125.json`
- **피처 수**: 403개
- **방법**: 개별 닭 ID를 추적하여 이전+현재 프레임 합집합의 optical flow 통계를 분위수 기반 히스토그램으로 변환

| 지표 | CV 평균 | CV 표준편차 | 테스트 |
|------|---------|-------------|--------|
| Accuracy | **85.22%** | ±0.32% | **84.62%** |
| Precision | 85.57% | ±0.53% | 84.82% |
| Recall | 84.72% | ±0.95% | 84.35% |
| F1 Score | **85.14%** | ±0.38% | **84.58%** |
| **AUC** | **92.90%** | ±0.36% | **92.73%** |

---

## 3. 성능 비교 요약

### 테스트셋 기준 비교

| 방법 | 피처 수 | Accuracy | AUC | 특징 |
|------|---------|----------|-----|------|
| A. 전체-이전 | 17 | 77.19% | 85.88% | 기본 baseline |
| B. 전체-합집합 | 17 | 77.59% | 85.25% | 합집합으로 소폭 하락 |
| C. ID별-이전 | 403 | 83.99% | 91.46% | ID 추적으로 대폭 향상 |
| **D. ID별-합집합** | 403 | **84.62%** | **92.73%** | **최고 성능** |

### 성능 향상 분석

```
                    Accuracy 향상    AUC 향상
A → C (ID 추적 효과):   +6.80%p       +5.58%p
C → D (합집합 효과):    +0.63%p       +1.27%p
A → D (전체 향상):      +7.43%p       +6.85%p
```

---

## 4. 주요 발견사항

### 4.1 ID별 추적의 효과 (핵심 발견)
- **Accuracy**: 77.19% → 83.99% (+6.80%p)
- **AUC**: 85.88% → 91.46% (+5.58%p)

개별 닭을 ID로 추적하여 분석하는 것이 전체 프레임 기반 분석보다 **6-7%p 높은 성능**을 보였다. 이는 병든 닭의 움직임 패턴이 개별 단위에서 더 명확하게 드러남을 시사한다.

### 4.2 이전/현재 프레임 합집합의 효과
- 전체 프레임 방식 (A→B): 성능 하락 (-0.63%p AUC)
- ID별 추적 방식 (C→D): 성능 향상 (+1.27%p AUC)

합집합 사용은 ID별 추적 방식에서만 효과적이었다. 전체 프레임 방식에서는 오히려 노이즈가 증가한 것으로 보인다.

### 4.3 중요 피처 (방법 D 기준)
1. `mag_mean_p00` (7303) - 매우 낮은 평균 움직임을 보이는 ID 비율
2. `dir_uni_p99` (5241) - 매우 높은 방향 균일성을 보이는 ID 비율
3. `mag_mean_p01` (4671) - 낮은 평균 움직임 ID 비율
4. `activity_mean` (4335) - 전체 평균 활동량
5. `mag_mean_p02` (2133) - 낮은 움직임 ID 비율

**해석**: 병든 닭은 움직임이 적고(낮은 magnitude), 움직일 때도 방향이 일정한(높은 direction uniformity) 특성을 보인다.

---

## 5. 결론

1. **최적 방법**: ID별 추적 + 이전/현재 합집합 (방법 D)
   - AUC 92.73%, Accuracy 84.62%

2. **핵심 통찰**:
   - 개별 닭 추적이 전체 프레임 분석보다 훨씬 효과적
   - 병든 닭은 "느리고 일정한 방향" 움직임 패턴을 보임
   - 분위수 기반 히스토그램 피처가 효과적으로 분포 차이를 포착

3. **실용적 가치**:
   - 92.73% AUC는 실제 양계장 모니터링에 적용 가능한 수준
   - Confusion Matrix 기준 False Negative(놓친 병든 닭) 198/1265 = 15.7%

---

## 6. 향후 개선 방향

1. **시계열 분석**: 단일 프레임이 아닌 연속 프레임 패턴 분석
2. **앙상블**: 전체 프레임 + ID별 모델 결합
3. **임계값 조정**: Recall 향상을 위한 threshold 최적화
4. **추가 피처**: 위치 정보, 군집 행동 패턴 등 추가
